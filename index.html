<!DOCTYPE html>

<html lang="zh-Hant">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>JSON 檔案檢視器</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>

        body {

            background-color: #f8fafc;

        }

        .json-key { color: #881391; }

        .json-string { color: #1a1aa6; }

        .json-number { color: #1c00cf; }

        .json-boolean { color: #0000ff; }

        .json-null { color: #808080; }

        pre {

            white-space: pre-wrap;

            word-wrap: break-word;

        }

    </style>

</head>

<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-5xl mx-auto">

        <!-- 標題部分 -->

        <header class="mb-8 text-center">

            <h1 class="text-3xl font-bold text-gray-800">JSON 檔案檢視器</h1>

            <p class="text-gray-600 mt-2">選擇或拖放 JSON 檔案即可立即預覽內容</p>

        </header>



        <!-- 操作區 -->

        <div class="bg-white rounded-xl shadow-md p-6 mb-6">

            <div class="flex flex-col md:flex-row items-center justify-between gap-4">

                <div class="w-full md:w-auto">

                    <label for="fileInput" class="block w-full cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition text-center">

                        選擇 JSON 檔案

                        <input type="file" id="fileInput" accept=".json" class="hidden">

                    </label>

                </div>

                

                <div id="statusMessage" class="flex-grow text-sm text-gray-500 italic text-center md:text-left">

                    等待檔案上傳...

                </div>



                <div class="flex gap-2">

                    <button id="copyBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition hidden">

                        複製內容

                    </button>

                    <button id="clearBtn" class="bg-red-50 hover:bg-red-100 text-red-600 font-medium py-2 px-4 rounded-lg transition hidden">

                        清除

                    </button>

                </div>

            </div>

            

            <!-- 拖放區 -->

            <div id="dropZone" class="mt-4 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center text-gray-400 hover:border-blue-400 hover:text-blue-500 transition-all cursor-pointer">

                或者將 JSON 檔案拖放到此處

            </div>

        </div>



        <!-- 顯示內容區 -->

        <div id="viewerContainer" class="bg-white rounded-xl shadow-md overflow-hidden hidden">

            <div class="bg-gray-50 px-4 py-2 border-b border-gray-200 flex justify-between items-center text-xs font-mono text-gray-500">

                <span>JSON 內容</span>

                <span id="fileSize">0 KB</span>

            </div>

            <div class="p-6 overflow-auto max-h-[70vh]">

                <pre id="jsonOutput" class="text-sm font-mono"></pre>

            </div>

        </div>



        <!-- 錯誤提示 -->

        <div id="errorBox" class="bg-red-50 border-l-4 border-red-500 p-4 rounded shadow-sm hidden">

            <div class="flex">

                <div class="ml-3">

                    <p class="text-sm text-red-700 font-bold">格式錯誤</p>

                    <p id="errorMessage" class="text-sm text-red-600 mt-1"></p>

                </div>

            </div>

        </div>

    </div>



    <script>

        const fileInput = document.getElementById('fileInput');

        const dropZone = document.getElementById('dropZone');

        const jsonOutput = document.getElementById('jsonOutput');

        const viewerContainer = document.getElementById('viewerContainer');

        const statusMessage = document.getElementById('statusMessage');

        const errorBox = document.getElementById('errorBox');

        const errorMessage = document.getElementById('errorMessage');

        const copyBtn = document.getElementById('copyBtn');

        const clearBtn = document.getElementById('clearBtn');

        const fileSizeLabel = document.getElementById('fileSize');



        // 監聽文件選擇

        fileInput.addEventListener('change', handleFileSelect);



        // 拖放功能

        dropZone.addEventListener('dragover', (e) => {

            e.preventDefault();

            dropZone.classList.add('border-blue-400', 'bg-blue-50');

        });



        dropZone.addEventListener('dragleave', () => {

            dropZone.classList.remove('border-blue-400', 'bg-blue-50');

        });



        dropZone.addEventListener('drop', (e) => {

            e.preventDefault();

            dropZone.classList.remove('border-blue-400', 'bg-blue-50');

            const files = e.dataTransfer.files;

            if (files.length > 0) {

                processFile(files[0]);

            }

        });



        dropZone.addEventListener('click', () => fileInput.click());



        // 清除功能

        clearBtn.addEventListener('click', () => {

            jsonOutput.textContent = '';

            viewerContainer.classList.add('hidden');

            copyBtn.classList.add('hidden');

            clearBtn.classList.add('hidden');

            errorBox.classList.add('hidden');

            statusMessage.textContent = '等待檔案上傳...';

            fileInput.value = '';

        });



        // 複製功能 (使用相容性較好的 execCommand)

        copyBtn.addEventListener('click', () => {

            const text = jsonOutput.textContent;

            const textArea = document.createElement("textarea");

            textArea.value = text;

            document.body.appendChild(textArea);

            textArea.select();

            try {

                document.execCommand('copy');

                const originalText = copyBtn.textContent;

                copyBtn.textContent = '已複製！';

                copyBtn.classList.replace('bg-gray-100', 'bg-green-100');

                copyBtn.classList.replace('text-gray-700', 'text-green-700');

                setTimeout(() => {

                    copyBtn.textContent = originalText;

                    copyBtn.classList.replace('bg-green-100', 'bg-gray-100');

                    copyBtn.classList.replace('text-green-700', 'text-gray-700');

                }, 2000);

            } catch (err) {

                console.error('無法複製', err);

            }

            document.body.removeChild(textArea);

        });



        function handleFileSelect(event) {

            const file = event.target.files[0];

            if (file) {

                processFile(file);

            }

        }



        function processFile(file) {

            if (file.type !== "application/json" && !file.name.endsWith('.json')) {

                showError("請上傳有效的 .json 檔案。");

                return;

            }



            const reader = new FileReader();

            statusMessage.textContent = `正在讀取: ${file.name}...`;

            

            reader.onload = function(e) {

                const content = e.target.result;

                try {

                    const jsonObj = JSON.parse(content);

                    displayJson(jsonObj);

                    statusMessage.textContent = `成功讀取: ${file.name}`;

                    fileSizeLabel.textContent = (file.size / 1024).toFixed(2) + " KB";

                    errorBox.classList.add('hidden');

                    viewerContainer.classList.remove('hidden');

                    copyBtn.classList.remove('hidden');

                    clearBtn.classList.remove('hidden');

                } catch (err) {

                    showError("JSON 語法錯誤: " + err.message);

                }

            };



            reader.onerror = function() {

                showError("讀取檔案時發生錯誤。");

            };



            reader.readAsText(file);

        }



        function displayJson(obj) {

            // 使用自定義的渲染函數來增加語法高亮

            const jsonString = JSON.stringify(obj, null, 4);

            jsonOutput.innerHTML = syntaxHighlight(jsonString);

        }



        function syntaxHighlight(json) {

            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {

                let cls = 'json-number';

                if (/^"/.test(match)) {

                    if (/:$/.test(match)) {

                        cls = 'json-key';

                    } else {

                        cls = 'json-string';

                    }

                } else if (/true|false/.test(match)) {

                    cls = 'json-boolean';

                } else if (/null/.test(match)) {

                    cls = 'json-null';

                }

                return '<span class="' + cls + '">' + match + '</span>';

            });

        }



        function showError(msg) {

            errorMessage.textContent = msg;

            errorBox.classList.remove('hidden');

            viewerContainer.classList.add('hidden');

            copyBtn.classList.add('hidden');

            clearBtn.classList.remove('hidden');

            statusMessage.textContent = "發生錯誤";

        }

    </script>

</body>

</html>
