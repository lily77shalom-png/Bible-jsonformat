<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Bibl    e Reader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Serif TC', serif;
        }
        .sidebar-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .reading-area {
            max-height: calc(100vh - 120px);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 z-20 relative">
        <div class="flex items-center gap-4">
            <h1 id="translation-title" class="text-xl font-bold text-indigo-700">Bible Reader</h1>
            <span id="current-location" class="text-slate-500 text-sm hidden md:inline-block"></span>
        </div>
        <div class="flex items-center gap-3">
            <div class="relative group">
                <input type="text" id="search-input" placeholder="搜尋經文..." class="bg-slate-100 border-none rounded-full px-4 py-1.5 text-sm focus:ring-2 focus:ring-indigo-500 w-48 transition-all duration-300 focus:w-64">
                <button id="search-btn" class="absolute right-3 top-2 text-slate-400 hover:text-indigo-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </button>
            </div>
            <label class="cursor-pointer bg-indigo-600 text-white px-4 py-1.5 rounded-full text-sm font-medium hover:bg-indigo-700 transition-colors">
                開啟 JSON
                <input type="file" id="json-upload" class="hidden" accept=".json">
            </label>
        </div>
    </header>

    <main class="flex h-screen pt-16 -mt-16">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="w-64 bg-white border-r border-slate-200 flex flex-col hidden">
            <div class="p-4 border-b border-slate-100 bg-slate-50/50">
                <h2 class="text-xs font-bold uppercase tracking-wider text-slate-400">書卷目錄</h2>
            </div>
            <div id="books-list" class="flex-1 overflow-y-auto sidebar-scroll">
                <!-- Books injected here -->
            </div>
        </aside>

        <!-- Chapter Navigation (Second Column) -->
        <aside id="chapter-sidebar" class="w-20 bg-slate-50 border-r border-slate-200 flex flex-col hidden">
            <div class="p-4 border-b border-slate-200 text-center">
                <h2 class="text-xs font-bold text-slate-400">章</h2>
            </div>
            <div id="chapters-list" class="flex-1 overflow-y-auto sidebar-scroll">
                <!-- Chapters injected here -->
            </div>
        </aside>

        <!-- Main Content -->
        <section class="flex-1 overflow-y-auto reading-area p-8 md:p-12 scroll-smooth" id="content-display">
            <div id="welcome-screen" class="max-w-2xl mx-auto text-center mt-20">
                <div class="bg-indigo-50 w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="text-indigo-600 h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-slate-800 mb-4">歡迎使用聖經閱讀器</h2>
                <p class="text-slate-600 leading-relaxed mb-8">請點擊右上方的「開啟 JSON」按鈕，並選擇您的 <strong>ChiUn.json</strong> 檔案開始閱讀。</p>
            </div>

            <!-- Reading Content Wrapper -->
            <div id="bible-content" class="max-w-3xl mx-auto hidden">
                <h2 id="view-book-name" class="text-4xl font-bold mb-2"></h2>
                <h3 id="view-chapter-num" class="text-xl text-slate-400 mb-8 pb-4 border-b border-slate-100"></h3>
                <div id="verses-container" class="space-y-6 text-xl leading-loose tracking-wide">
                    <!-- Verses injected here -->
                </div>
            </div>

            <!-- Search Results Wrapper -->
            <div id="search-results" class="max-w-3xl mx-auto hidden">
                <h2 class="text-2xl font-bold mb-6">搜尋結果</h2>
                <div id="results-container" class="space-y-4">
                    <!-- Results injected here -->
                </div>
            </div>
        </section>
    </main>

    <script>
        let bibleData = null;
        let activeBookIdx = 0;
        let activeChapterIdx = 0;

        const upload = document.getElementById('json-upload');
        const sidebar = document.getElementById('sidebar');
        const chapSidebar = document.getElementById('chapter-sidebar');
        const booksList = document.getElementById('books-list');
        const chaptersList = document.getElementById('chapters-list');
        const welcomeScreen = document.getElementById('welcome-screen');
        const bibleContent = document.getElementById('bible-content');
        const versesContainer = document.getElementById('verses-container');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        const resultsContainer = document.getElementById('results-container');

        upload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    bibleData = JSON.parse(event.target.result);
                    initApp();
                } catch (err) {
                    alert('無法解析 JSON 檔案。請確保格式正確。');
                }
            };
            reader.readAsText(file);
        });

        function initApp() {
            document.getElementById('translation-title').textContent = bibleData.translation || "聖經閱讀器";
            sidebar.classList.remove('hidden');
            chapSidebar.classList.remove('hidden');
            welcomeScreen.classList.add('hidden');
            renderBooks();
            loadChapter(0, 0);
        }

        function renderBooks() {
            booksList.innerHTML = '';
            bibleData.books.forEach((book, idx) => {
                const btn = document.createElement('button');
                btn.className = `w-full text-left px-4 py-3 text-sm transition-all border-l-4 ${activeBookIdx === idx ? 'bg-indigo-50 border-indigo-600 text-indigo-700 font-bold' : 'border-transparent text-slate-600 hover:bg-slate-50'}`;
                btn.textContent = book.name;
                btn.onclick = () => selectBook(idx);
                booksList.appendChild(btn);
            });
        }

        function selectBook(idx) {
            activeBookIdx = idx;
            activeChapterIdx = 0;
            renderBooks();
            renderChapters();
            loadChapter(activeBookIdx, activeChapterIdx);
        }

        function renderChapters() {
            chaptersList.innerHTML = '';
            const book = bibleData.books[activeBookIdx];
            book.chapters.forEach((chap, idx) => {
                const btn = document.createElement('button');
                btn.className = `w-full py-3 text-sm transition-all ${activeChapterIdx === idx ? 'bg-indigo-600 text-white font-bold' : 'text-slate-500 hover:bg-slate-200'}`;
                btn.textContent = chap.chapter;
                btn.onclick = () => {
                    activeChapterIdx = idx;
                    renderChapters();
                    loadChapter(activeBookIdx, activeChapterIdx);
                };
                chaptersList.appendChild(btn);
            });
        }

        function loadChapter(bookIdx, chapIdx) {
            const book = bibleData.books[bookIdx];
            const chapter = book.chapters[chapIdx];
            
            searchResults.classList.add('hidden');
            bibleContent.classList.remove('hidden');
            
            document.getElementById('view-book-name').textContent = book.name;
            document.getElementById('view-chapter-num').textContent = `第 ${chapter.chapter} 章`;
            document.getElementById('current-location').textContent = `${book.name} 第 ${chapter.chapter} 章`;
            
            versesContainer.innerHTML = '';
            chapter.verses.forEach(v => {
                const p = document.createElement('p');
                p.className = "flex gap-4 group";
                p.innerHTML = `
                    <span class="text-indigo-400 text-sm font-bold min-w-[2rem] pt-1.5 select-none">${v.verse}</span>
                    <span class="flex-1">${v.text}</span>
                `;
                versesContainer.appendChild(p);
            });
            
            if (chaptersList.children.length === 0) renderChapters();
            document.getElementById('content-display').scrollTop = 0;
        }

        // Search logic
        function performSearch() {
            const query = searchInput.value.trim();
            if (!query || !bibleData) return;

            bibleContent.classList.add('hidden');
            searchResults.classList.remove('hidden');
            resultsContainer.innerHTML = '';

            let matches = 0;
            bibleData.books.forEach((book, bIdx) => {
                book.chapters.forEach((chap, cIdx) => {
                    chap.verses.forEach(v => {
                        if (v.text.includes(query)) {
                            matches++;
                            const div = document.createElement('div');
                            div.className = "p-4 bg-white border border-slate-200 rounded-lg shadow-sm hover:border-indigo-300 transition-all cursor-pointer";
                            div.innerHTML = `
                                <div class="text-xs font-bold text-indigo-600 mb-1">${book.name} ${chap.chapter}:${v.verse}</div>
                                <div class="text-slate-700">${v.text.replace(query, `<mark class="bg-yellow-200">${query}</mark>`)}</div>
                            `;
                            div.onclick = () => {
                                activeBookIdx = bIdx;
                                activeChapterIdx = cIdx;
                                renderBooks();
                                renderChapters();
                                loadChapter(bIdx, cIdx);
                            };
                            resultsContainer.appendChild(div);
                        }
                    });
                });
            });

            if (matches === 0) {
                resultsContainer.innerHTML = `<p class="text-slate-500 italic">找不到與 "${query}" 相關的經文。</p>`;
            }
        }

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
        document.getElementById('search-btn').onclick = performSearch;
    </script>
</body>
</html>
