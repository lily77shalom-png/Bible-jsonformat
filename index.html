<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON 專業檢視器 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;600&display=swap');
        
        :root {
            --key-color: #881391;
            --string-color: #059669;
            --number-color: #2563eb;
            --bool-color: #d97706;
            --null-color: #64748b;
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --border-color: #e2e8f0;
        }

        .dark-mode {
            --key-color: #d8b4fe;
            --string-color: #4ade80;
            --number-color: #60a5fa;
            --bool-color: #fbbf24;
            --null-color: #94a3b8;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --border-color: #334155;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .json-tree-container {
            font-family: 'Fira Code', monospace;
            line-height: 1.6;
        }

        .json-item {
            margin-left: 24px;
            border-left: 1px dashed var(--border-color);
            padding-left: 12px;
        }

        .toggle-icon {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: var(--border-color);
            border-radius: 4px;
            margin-right: 8px;
            font-size: 12px;
            user-select: none;
            transition: all 0.2s;
            vertical-align: middle;
        }

        .collapsed > .json-item, .collapsed > .bracket-close {
            display: none;
        }

        .collapsed > .toggle-icon::before { content: '+'; }
        .expanded > .toggle-icon::before { content: '-'; }

        .json-key { color: var(--key-color); cursor: pointer; }
        .json-key:hover { text-decoration: underline; }
        .json-string { color: var(--string-color); }
        .json-number { color: var(--number-color); }
        .json-boolean { color: var(--bool-color); }
        .json-null { color: var(--null-color); }

        .item-count {
            font-size: 11px;
            color: #94a3b8;
            margin-left: 8px;
            font-style: italic;
        }

        .search-highlight {
            background-color: #fef08a;
            color: #000;
            border-radius: 2px;
            box-shadow: 0 0 0 2px #fde047;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .dark-mode .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; }

        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="flex flex-col h-screen">
        <!-- 頂部導覽列 -->
        <header class="card border-b px-6 py-4 flex items-center justify-between shadow-sm z-20">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-lg shadow-lg shadow-indigo-500/20">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold">JSON Pro Viewer</h1>
                    <p id="fileInfo" class="text-xs opacity-60">Ready to analyze</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" title="切換主題">
                    <svg id="sunIcon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"></path></svg>
                    <svg id="moonIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
                <input type="file" id="fileInput" accept=".json" class="hidden">
                <button onclick="document.getElementById('fileInput').click()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-full text-sm font-semibold transition-all shadow-md">
                    開啟檔案
                </button>
            </div>
        </header>

        <!-- 工具列 -->
        <div id="toolbar" class="bg-opacity-50 backdrop-blur-md card border-b px-6 py-2 flex flex-wrap items-center gap-4 hidden">
            <div class="relative flex-grow max-w-md">
                <input type="text" id="searchInput" placeholder="搜尋鍵值或內容..." class="pl-4 pr-10 py-1.5 w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded-full text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                <span id="searchCount" class="absolute right-4 inset-y-0 flex items-center text-xs opacity-50"></span>
            </div>

            <div class="flex items-center gap-1 border-x px-4 border-gray-300 dark:border-gray-600">
                <button id="expandAll" class="text-xs hover:bg-gray-200 dark:hover:bg-gray-700 px-3 py-1.5 rounded transition">全部展開</button>
                <button id="collapseAll" class="text-xs hover:bg-gray-200 dark:hover:bg-gray-700 px-3 py-1.5 rounded transition">全部摺疊</button>
            </div>

            <div class="flex items-center gap-2 ml-auto">
                <button id="copyBtn" class="text-xs px-3 py-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition">複製 JSON</button>
                <button id="downloadBtn" class="text-xs text-indigo-500 font-bold px-3 py-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition">下載</button>
                <button id="clearBtn" class="text-xs text-red-500 px-3 py-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition">清除</button>
            </div>
        </div>

        <!-- 主內容區 -->
        <main class="flex-grow overflow-hidden relative">
            <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-center text-center p-6">
                <div class="w-20 h-20 bg-indigo-100 dark:bg-indigo-900/30 rounded-2xl flex items-center justify-center mb-6">
                    <svg class="w-10 h-10 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                </div>
                <h2 class="text-2xl font-bold mb-2">拖放 JSON 到這裡</h2>
                <p class="opacity-50 text-sm">支援大檔案預覽與結構化搜尋</p>
            </div>

            <div id="viewer" class="h-full overflow-auto p-8 custom-scrollbar hidden">
                <div id="jsonTree" class="json-tree-container text-[13px]"></div>
            </div>

            <!-- Toast 提示 -->
            <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg text-sm shadow-2xl transition-all opacity-0 pointer-events-none z-50">
                路徑已複製
            </div>
        </main>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const emptyState = document.getElementById('emptyState');
        const viewer = document.getElementById('viewer');
        const toolbar = document.getElementById('toolbar');
        const jsonTree = document.getElementById('jsonTree');
        const fileInfo = document.getElementById('fileInfo');
        const searchInput = document.getElementById('searchInput');
        const searchCount = document.getElementById('searchCount');
        const themeToggle = document.getElementById('themeToggle');
        const toast = document.getElementById('toast');

        let currentData = null;
        let isDarkMode = false;

        // 主題切換
        themeToggle.onclick = () => {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.getElementById('sunIcon').classList.toggle('hidden', !isDarkMode);
            document.getElementById('moonIcon').classList.toggle('hidden', isDarkMode);
        };

        // 監聽文件
        fileInput.addEventListener('change', e => { if(e.target.files[0]) handleFile(e.target.files[0]); });
        document.body.ondragover = e => { e.preventDefault(); document.body.style.opacity = '0.7'; };
        document.body.ondragleave = () => { document.body.style.opacity = '1'; };
        document.body.ondrop = e => {
            e.preventDefault();
            document.body.style.opacity = '1';
            if(e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
        };

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const data = JSON.parse(e.target.result);
                    renderApp(data, file.name, file.size);
                } catch (err) {
                    alert("JSON 解析錯誤: " + err.message);
                }
            };
            reader.readAsText(file);
        }

        function renderApp(data, name, size) {
            currentData = data;
            fileInfo.textContent = `${name} • ${(size / 1024).toFixed(1)} KB`;
            emptyState.classList.add('hidden');
            viewer.classList.remove('hidden');
            toolbar.classList.remove('hidden');
            jsonTree.innerHTML = '';
            jsonTree.appendChild(createTreeNode(data, '', true, null));
        }

        function createTreeNode(val, path, isLast, label = null) {
            const container = document.createElement('div');
            container.className = 'json-node expanded';

            const isObject = val !== null && typeof val === 'object';
            const isArray = Array.isArray(val);
            const currentPath = path;

            const line = document.createElement('div');
            line.className = 'flex items-baseline';

            if (isObject) {
                const toggle = document.createElement('span');
                toggle.className = 'toggle-icon';
                toggle.onclick = () => container.classList.toggle('collapsed');
                line.appendChild(toggle);
            }

            if (label !== null) {
                const keySpan = document.createElement('span');
                keySpan.className = 'json-key';
                keySpan.textContent = `"${label}"`;
                keySpan.onclick = (e) => {
                    e.stopPropagation();
                    copyToClipboard(currentPath);
                    showToast(`路徑已複製: ${currentPath || 'root'}`);
                };
                line.appendChild(keySpan);
                line.appendChild(document.createTextNode(': '));
            }

            if (isObject) {
                const openBracket = document.createTextNode(isArray ? '[' : '{');
                line.appendChild(openBracket);

                const count = isArray ? val.length : Object.keys(val).length;
                const countSpan = document.createElement('span');
                countSpan.className = 'item-count';
                countSpan.textContent = `// ${count} ${isArray ? 'items' : 'keys'}`;
                line.appendChild(countSpan);
                container.appendChild(line);

                const itemWrapper = document.createElement('div');
                itemWrapper.className = 'json-item';
                
                if (isArray) {
                    val.forEach((v, i) => {
                        itemWrapper.appendChild(createTreeNode(v, `${path}[${i}]`, i === val.length - 1, null));
                    });
                } else {
                    const keys = Object.keys(val);
                    keys.forEach((k, i) => {
                        const newPath = path ? `${path}.${k}` : k;
                        itemWrapper.appendChild(createTreeNode(val[k], newPath, i === keys.length - 1, k));
                    });
                }
                container.appendChild(itemWrapper);

                const closeBracket = document.createElement('div');
                closeBracket.className = 'bracket-close';
                closeBracket.textContent = (isArray ? ']' : '}') + (isLast ? '' : ',');
                container.appendChild(closeBracket);
            } else {
                const valSpan = document.createElement('span');
                if (typeof val === 'string') {
                    valSpan.className = 'json-string';
                    valSpan.textContent = `"${val}"`;
                } else if (typeof val === 'number') {
                    valSpan.className = 'json-number';
                    valSpan.textContent = val;
                } else if (typeof val === 'boolean') {
                    valSpan.className = 'json-boolean';
                    valSpan.textContent = val;
                } else if (val === null) {
                    valSpan.className = 'json-null';
                    valSpan.textContent = 'null';
                }
                line.appendChild(valSpan);
                if (!isLast) line.appendChild(document.createTextNode(','));
                container.appendChild(line);
            }
            return container;
        }

        // 搜尋邏輯
        searchInput.oninput = e => {
            const term = e.target.value.toLowerCase();
            const nodes = jsonTree.querySelectorAll('.json-key, .json-string, .json-number, .json-boolean');
            let found = 0;

            nodes.forEach(node => {
                const text = node.textContent.toLowerCase();
                if (term && text.includes(term)) {
                    node.classList.add('search-highlight');
                    found++;
                    let p = node.closest('.collapsed');
                    while(p) { p.classList.replace('collapsed', 'expanded'); p = p.parentElement.closest('.collapsed'); }
                } else {
                    node.classList.remove('search-highlight');
                }
            });
            searchCount.textContent = term ? `找到 ${found} 處` : '';
            
            // 自動捲動到第一個匹配
            if (term && found > 0) {
                const first = jsonTree.querySelector('.search-highlight');
                if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        };

        // 按鈕功能
        document.getElementById('expandAll').onclick = () => jsonTree.querySelectorAll('.collapsed').forEach(n => n.classList.replace('collapsed', 'expanded'));
        document.getElementById('collapseAll').onclick = () => jsonTree.querySelectorAll('.expanded').forEach(n => { if(n.parentElement !== jsonTree) n.classList.replace('expanded', 'collapsed')});
        document.getElementById('clearBtn').onclick = () => { currentData = null; emptyState.classList.remove('hidden'); viewer.classList.add('hidden'); toolbar.classList.add('hidden'); fileInput.value = ''; };
        document.getElementById('copyBtn').onclick = () => { copyToClipboard(JSON.stringify(currentData, null, 4)); showToast("完整 JSON 已複製"); };
        document.getElementById('downloadBtn').onclick = () => {
            const blob = new Blob([JSON.stringify(currentData, null, 4)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'data_formatted.json'; a.click();
        };

        function copyToClipboard(text) {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
        }

        function showToast(msg) {
            toast.textContent = msg;
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 2000);
        }
    </script>
</body>
</html>
